<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø±Ù…Ø¶Ø§Ù†ÙŠØ§Øª Ù…Ø¹Ø§Ø°: Ø±ÙÙŠÙ‚Ùƒ Ø§Ù„Ø´Ø§Ù…Ù„ ÙÙŠ Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ.">
    <meta name="theme-color" content="#10b981">
    <title>Ø±Ù…Ø¶Ø§Ù†ÙŠØ§Øª Ù…Ø¹Ø§Ø° | Moath Ramadaniyat</title>
    
    <!-- PWA Settings -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@300;400;600;800&family=Reem+Kufi:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Cairo', 'ui-sans-serif'], serif: ['Amiri', 'ui-serif'], kufi: ['Reem Kufi', 'sans-serif'] },
                    colors: { emerald: { 50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399', 500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b', 950: '#022c22' }, gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' } },
                    animation: { 'spin-slow': 'spin 12s linear infinite', 'pulse-glow': 'pulseGlow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
                    keyframes: { pulseGlow: { '0%, 100%': { opacity: '1', boxShadow: '0 0 20px rgba(16, 185, 129, 0.4)' }, '50%': { opacity: '0.7', boxShadow: '0 0 10px rgba(16, 185, 129, 0.1)' } } },
                    backgroundImage: { 'islamic-pattern': "url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2310b981' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")" }
                }
            }
        }
    </script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.18); }
        .dark .glass { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.05); }
        .markdown-body p { margin-bottom: 0.5em; }
        body { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 h-[100dvh] w-full overflow-hidden selection:bg-emerald-200 dark:selection:bg-emerald-800 bg-islamic-pattern">

    <div id="root" class="h-full w-full"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const { useState, useEffect, useRef, useMemo } = React;

        let app, auth, db, appId;
        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                const firebaseConfig = JSON.parse(__firebase_config);
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'ramadan-app-demo';
            } else {
                console.warn("Offline Mode");
                auth = { currentUser: { uid: 'guest' }, onAuthStateChanged: (cb) => cb({ uid: 'guest' }) };
                db = null;
            }
        } catch (error) { console.error(error); }

        const RADIO_URL = "https://backup.qurango.net/radio/mohammed_ayyub";
        const apiKey = ""; 

        const AI_DATA = {
            tips: [ "Ø§Ø¨Ø¯Ø£ Ø¥ÙØ·Ø§Ø±Ùƒ Ø¨ØªÙ…Ø±.", "Ø£Ø®Ø± Ø§Ù„Ø³Ø­ÙˆØ±.", "ØªØ¬Ù†Ø¨ Ø§Ù„Ù…ÙˆØ§Ù„Ø­.", "Ø§Ù…Ø´Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø±.", "Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù†ØªØ¸Ø§Ù…." ],
            allah: [ {n: "Ø§Ù„Ø±Ø²Ø§Ù‚", m: "Ø®Ø§Ù„Ù‚ Ø§Ù„Ø£Ø±Ø²Ø§Ù‚"}, {n: "Ø§Ù„ÙˆØ¯ÙˆØ¯", m: "Ø§Ù„Ù…Ø­Ø¨ Ù„Ø¹Ø¨Ø§Ø¯Ù‡"}, {n: "Ø§Ù„ØºÙØ§Ø±", m: "Ø§Ù„Ø³Ø§ØªØ± Ù„Ù„Ø°Ù†ÙˆØ¨"} ]
        };

        const Icons = {
            Home: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Grid: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Moon: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={p.fill||"none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Sun: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Book: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Radio: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>,
            Pause: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></svg>,
            Settings: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Check: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Bookmark: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={p.fill||"none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>,
            Search: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Send: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Bot: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2 2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/><path d="M19 12a7 7 0 0 0-7-7 7 7 0 0 0-7 7v5a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-5Z"/><line x1="8" x2="8" y1="13" y2="13"/><line x1="16" x2="16" y1="13" y2="13"/></svg>,
            Map: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>,
            Compass: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m16.24 7.76-2.12 6.36-6.36 2.12 2.12-6.36 6.36-2.12z"/></svg>,
            Image: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            Download: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Sparkles: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
            ChevronRight: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            Table: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></svg>,
            Calculator: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Brain: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            History: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
        };

        const NavBtn = ({ icon: Icon, label, active, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center justify-center h-full flex-1 transition-all duration-300 ${active ? 'text-emerald-600' : 'text-slate-400 hover:text-slate-600'}`}>
                <div className={`transition-all duration-300 ${active ? '-translate-y-1' : ''}`}>
                    <Icon size={18} strokeWidth={active ? 2.5 : 2} />
                </div>
                <span className={`text-[8px] font-bold mt-0.5 transition-opacity duration-300 ${active ? 'opacity-100' : 'opacity-70'}`}>{label}</span>
            </button>
        );

        const RadioPlayer = () => {
            const [playing, setPlaying] = useState(false);
            const audio = useRef(null);
            useEffect(() => { 
                audio.current = new Audio(RADIO_URL); 
                audio.current.onerror = () => setPlaying(false);
                return () => { if(audio.current) audio.current.pause(); };
            }, []);
            const toggle = () => { 
                if(!audio.current) return;
                if(playing) audio.current.pause();
                else audio.current.play().catch(e => alert("Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹")); 
                setPlaying(!playing); 
            };
            return (
                <button onClick={toggle} className={`fixed bottom-16 left-3 z-50 w-8 h-8 rounded-full flex items-center justify-center shadow-lg border border-white dark:border-slate-800 transition-all active:scale-95 ${playing ? 'bg-red-500 animate-pulse text-white' : 'bg-slate-800 text-white'}`}>
                    {playing ? <Icons.Pause size={14}/> : <Icons.Radio size={14}/>}
                </button>
            );
        };

        const Dashboard = ({ prayerData }) => {
            const { times, next, left, date, location } = prayerData;
            const [aiText, setAiText] = useState({ tip: AI_DATA.tips[0], allah: AI_DATA.allah[0] });

            useEffect(() => {
                const i = setInterval(() => {
                    const seed = new Date().getMinutes();
                    setAiText({
                        tip: AI_DATA.tips[seed % AI_DATA.tips.length],
                        allah: AI_DATA.allah[seed % AI_DATA.allah.length]
                    });
                }, 60000);
                return () => clearInterval(i);
            }, []);

            if(!times) return <div className="h-full flex items-center justify-center"><div className="w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div></div>;

            return (
                <div className="p-4 pb-28 space-y-3 overflow-y-auto h-full no-scrollbar">
                    <div className="relative w-full bg-gradient-to-br from-emerald-800 to-slate-900 rounded-3xl p-5 text-white shadow-xl overflow-hidden min-h-[180px] flex flex-col justify-center text-center">
                        <div className="absolute inset-0 opacity-20 bg-islamic-pattern bg-repeat opacity-10"></div>
                        <div className="relative z-10">
                            <div className="flex justify-between text-[10px] opacity-80 mb-3 font-bold">
                                <span>{date}</span><span className="flex items-center gap-1"><Icons.Map size={10}/> {location}</span>
                            </div>
                            <h1 className="text-5xl font-mono font-bold tracking-tight mb-1 dir-ltr">{left}</h1>
                            <p className="text-emerald-300 text-xs font-medium">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ø£Ø°Ø§Ù† {next.name}</p>
                        </div>
                    </div>
                    <div className="bg-white dark:bg-slate-900 p-3 rounded-2xl flex justify-between items-center shadow-sm border border-slate-100 dark:border-slate-800 overflow-x-auto">
                        {['Fajr','Dhuhr','Asr','Maghrib','Isha'].map(k => {
                            const active = next.key === k;
                            const labels = {Fajr:'Ø§Ù„ÙØ¬Ø±',Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',Asr:'Ø§Ù„Ø¹ØµØ±',Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
                            return (
                                <div key={k} className={`flex flex-col items-center gap-1 transition-all min-w-[45px] ${active?'scale-110 text-emerald-600 font-bold':'text-slate-400'}`}>
                                    <span className="text-[9px]">{labels[k]}</span>
                                    <span className="font-mono text-xs whitespace-nowrap">{times[k].split(' ')[0]}</span>
                                </div>
                            )
                        })}
                    </div>
                    <div className="grid grid-cols-1 gap-2 animate-fade-in">
                        <div className="bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-800/30 p-3 rounded-2xl flex items-center justify-between shadow-sm">
                            <div>
                                <p className="text-[9px] font-bold text-amber-600 uppercase mb-0.5">Ù…Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡</p>
                                <h3 className="text-sm font-bold text-amber-800 dark:text-amber-500 font-serif">{aiText.allah.n}</h3>
                                <p className="text-[10px] text-amber-700/70 mt-0.5 dark:text-amber-300">{aiText.allah.m}</p>
                            </div>
                            <div className="text-amber-500 opacity-20"><Icons.Moon size={30}/></div>
                        </div>
                        <div className="bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800/30 p-3 rounded-2xl shadow-sm">
                            <div className="flex justify-between items-center mb-0.5">
                                <h3 className="text-xs font-bold text-blue-700 dark:text-blue-400 flex items-center gap-1"><Icons.Sparkles size={12}/> Ù†ØµÙŠØ­Ø© Ø°ÙƒÙŠØ©</h3>
                            </div>
                            <p className="text-[10px] text-slate-600 dark:text-slate-300 leading-relaxed">{aiText.tip}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const Imsakiya = ({ locationData }) => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchData = async () => {
                    if (!locationData || !locationData.lat) return;
                    setLoading(true); setError(null);
                    try {
                        const date = new Date();
                        const res = await fetch(`https://api.aladhan.com/v1/calendar?latitude=${locationData.lat}&longitude=${locationData.lng}&method=2&month=${date.getMonth()+1}&year=${date.getFullYear()}`);
                        const json = await res.json();
                        if (json.code === 200) setData(json.data); else setError('Ø®Ø·Ø£');
                    } catch (e) { setError('ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„'); }
                    setLoading(false);
                };
                fetchData();
            }, [locationData]);

            if (!locationData?.lat) return <div className="h-full flex flex-col items-center justify-center text-slate-500 text-xs"><div className="w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mb-2"></div>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>;
            if (loading) return <div className="h-full flex flex-col items-center justify-center text-emerald-600 text-xs"><div className="w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mb-2"></div>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>;

            return (
                <div className="h-full flex flex-col bg-slate-50 dark:bg-slate-950">
                    <div className="p-3 bg-white dark:bg-slate-900 shadow-sm z-10 sticky top-0">
                        <h2 className="text-lg font-bold text-emerald-800 dark:text-emerald-500 text-center font-kufi">Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ù…Ø¹Ø§Ø°</h2>
                        <p className="text-center text-[10px] text-slate-500">{locationData.location}</p>
                    </div>
                    <div className="flex-1 overflow-auto p-2 pb-28">
                        <div className="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 overflow-hidden">
                            <table className="w-full text-center text-xs">
                                <thead className="bg-emerald-50 dark:bg-emerald-900/20 text-emerald-800 dark:text-emerald-400 font-bold sticky top-0 shadow-sm">
                                    <tr><th className="p-2">Ø§Ù„ÙŠÙˆÙ…</th><th className="p-2">Ø§Ù„ÙØ¬Ø±</th><th className="p-2">Ø§Ù„Ø´Ø±ÙˆÙ‚</th><th className="p-2">Ø§Ù„Ù…ØºØ±Ø¨</th></tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100 dark:divide-slate-800">
                                    {data.map((day, i) => {
                                        const isToday = new Date().getDate() === parseInt(day.date.gregorian.day);
                                        return (
                                            <tr key={i} className={`transition-colors hover:bg-slate-50 dark:hover:bg-slate-800/50 ${isToday ? "bg-emerald-50/80 dark:bg-emerald-900/30 font-bold border-l-4 border-emerald-500" : ""}`}>
                                                <td className="p-2"><div className="font-bold">{day.date.hijri.day}</div></td>
                                                <td className="p-2 font-mono text-slate-600 dark:text-slate-300">{day.timings.Fajr.split(' ')[0]}</td>
                                                <td className="p-2 font-mono text-slate-400 dark:text-slate-500">{day.timings.Sunrise.split(' ')[0]}</td>
                                                <td className="p-2 font-mono text-emerald-600 dark:text-emerald-400 font-bold">{day.timings.Maghrib.split(' ')[0]}</td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const QuranReader = ({ savedPage, onSavePage }) => {
            const [page, setPage] = useState(savedPage || 1);
            const [verses, setVerses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showTools, setShowTools] = useState(true);
            const scrollRef = useRef(null);
            const [searchSurah, setSearchSurah] = useState('');
            const [searchAyah, setSearchAyah] = useState('');

            useEffect(() => { if(savedPage) setPage(savedPage); }, [savedPage]);
            useEffect(() => {
                setLoading(true);
                fetch(`https://api.alquran.cloud/v1/page/${page}/quran-uthmani`)
                    .then(r => r.json())
                    .then(d => { setVerses(d.data.ayahs); setLoading(false); if (scrollRef.current) scrollRef.current.scrollTop = 0; })
                    .catch(() => setLoading(false));
            }, [page]);

            const changePage = (d) => { const n = page + d; if(n >= 1 && n <= 604) setPage(n); };
            const goToVerse = async (e) => {
                e.preventDefault();
                try {
                    const res = await fetch(`https://api.alquran.cloud/v1/ayah/${searchSurah}:${searchAyah}`);
                    const data = await res.json();
                    if (data.code === 200 && data.data.page) { setPage(data.data.page); setShowTools(false); }
                } catch (err) {}
            };

            return (
                <div className="h-full bg-[#fdf6e3] dark:bg-[#1a1a1a] flex flex-col relative font-serif">
                    <div className={`absolute top-0 w-full p-2 bg-white/95 dark:bg-[#1a1a1a]/95 backdrop-blur z-20 shadow-lg border-b dark:border-slate-800 transition-all duration-300 ${showTools?'opacity-100 translate-y-0':'opacity-0 -translate-y-full pointer-events-none'}`}>
                        <div className="flex flex-col gap-2">
                            <div className="flex justify-between items-center">
                                <span className="font-bold text-sm dark:text-white font-sans">ØµÙØ­Ø© {page}</span>
                                <button onClick={() => { onSavePage(page); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); }} className="text-gold-500 p-1 bg-gold-50 dark:bg-gold-900/20 rounded-full flex items-center gap-1 text-[10px] font-bold"><Icons.Bookmark className="fill-current" size={14}/> Ø­ÙØ¸</button>
                            </div>
                            <form onSubmit={goToVerse} className="flex gap-2 p-1 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-700">
                                <input type="number" placeholder="Ø³ÙˆØ±Ø©" value={searchSurah} onChange={e=>setSearchSurah(e.target.value)} className="w-12 p-1 rounded bg-white dark:bg-slate-700 text-center outline-none text-xs dark:text-white" />
                                <input type="number" placeholder="Ø¢ÙŠØ©" value={searchAyah} onChange={e=>setSearchAyah(e.target.value)} className="w-12 p-1 rounded bg-white dark:bg-slate-700 text-center outline-none text-xs dark:text-white" />
                                <button type="submit" className="flex-1 bg-emerald-600 text-white rounded px-2 text-xs font-bold">Ø°Ù‡Ø§Ø¨</button>
                            </form>
                        </div>
                    </div>
                    <button onClick={()=>changePage(1)} disabled={page>=604} className="absolute left-0 top-1/2 -translate-y-1/2 p-1 m-1 bg-emerald-600/80 text-white rounded-full shadow-lg z-10 disabled:opacity-0"><Icons.ChevronLeft size={20}/></button>
                    <button onClick={()=>changePage(-1)} disabled={page<=1} className="absolute right-0 top-1/2 -translate-y-1/2 p-1 m-1 bg-emerald-600/80 text-white rounded-full shadow-lg z-10 disabled:opacity-0"><Icons.ChevronRight size={20}/></button>
                    <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 sm:p-5 no-scrollbar cursor-pointer pt-20" onClick={()=>setShowTools(!showTools)}>
                        {loading ? <div className="flex items-center justify-center h-full"><div className="w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"></div></div> : (
                            <div className="max-w-2xl mx-auto" dir="rtl">
                                {(() => {
                                    let content = []; let currentSurah = null; const bismillah = "Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù";
                                    verses.forEach((ayah) => {
                                        if (ayah.surah.number !== currentSurah) {
                                            currentSurah = ayah.surah.number;
                                            content.push(<div key={`head-${currentSurah}`} className="mt-6 mb-4 relative"><div className="absolute inset-0 flex items-center"><div className="w-full border-t border-emerald-300 dark:border-emerald-800"></div></div><div className="relative flex justify-center"><span className="bg-[#fdf6e3] dark:bg-[#1a1a1a] px-4 py-0.5 text-emerald-800 dark:text-emerald-400 font-bold text-lg border-2 border-emerald-600 rounded-full shadow-sm font-kufi">Ø³ÙˆØ±Ø© {ayah.surah.name}</span></div>{ayah.surah.number !== 1 && ayah.surah.number !== 9 && (<div className="text-center mt-3 text-lg font-serif text-slate-800 dark:text-slate-300 opacity-90">{bismillah}</div>)}</div>);
                                        }
                                        let text = ayah.text;
                                        if (ayah.surah.number !== 1 && ayah.numberInSurah === 1 && text.startsWith(bismillah)) text = text.replace(bismillah, '').trim();
                                        content.push(<span key={ayah.number} className="text-[22px] leading-[2] text-slate-900 dark:text-slate-100 font-serif tracking-wide inline">{text} <span className="text-emerald-600 dark:text-emerald-400 text-xl mx-1 font-sans inline-block select-none">ï´¿{ayah.numberInSurah}ï´¾</span></span>);
                                    });
                                    return <div className="pb-20"><div className="text-justify leading-loose mb-6">{content}</div><div className="flex justify-between items-center gap-2 pt-2 border-t border-slate-200 dark:border-slate-800"><button onClick={(e)=>{e.stopPropagation(); changePage(-1)}} disabled={page<=1} className="flex-1 flex items-center justify-center gap-1 px-3 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold text-xs"><Icons.ChevronRight size={14}/> Ø§Ù„Ø³Ø§Ø¨Ù‚</button><button onClick={(e)=>{e.stopPropagation(); changePage(1)}} disabled={page>=604} className="flex-1 flex items-center justify-center gap-1 px-3 py-2 rounded-lg bg-emerald-600 text-white font-bold text-xs hover:bg-emerald-700">Ø§Ù„ØªØ§Ù„ÙŠ <Icons.ChevronLeft size={14}/></button></div></div>;
                                })()}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const AdhkarHub = ({ savedCount, onSaveCount }) => {
            const [count, setCount] = useState(savedCount || 0);
            useEffect(() => { if(savedCount !== undefined) setCount(savedCount); }, [savedCount]);
            const increment = () => { const n = count + 1; setCount(n); onSaveCount(n); if(navigator.vibrate) navigator.vibrate(30); };
            return (
                <div className="flex flex-col items-center justify-center h-full pb-20 p-4">
                    <div onClick={increment} className="w-60 h-60 rounded-full bg-slate-900 dark:bg-slate-800 shadow-[0_0_40px_rgba(16,185,129,0.15)] flex flex-col items-center justify-center text-white cursor-pointer active:scale-95 transition-transform border-[6px] border-emerald-500/20 relative select-none">
                        <span className="text-6xl font-mono font-bold z-10">{count}</span>
                        <span className="text-[10px] opacity-60 mt-1 z-10 font-sans">Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¨ÙŠØ­</span>
                        <div className="absolute inset-0 rounded-full border-t-4 border-emerald-500/50 animate-spin-slow"></div>
                    </div>
                    <button onClick={()=>{if(confirm('ØªØµÙÙŠØ±ØŸ')){setCount(0); onSaveCount(0);}}} className="mt-8 text-xs text-slate-400 hover:text-red-500 font-bold px-3 py-1.5 border border-slate-200 dark:border-slate-800 rounded-full">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
                </div>
            );
        };

        const GeminiAssistant = () => {
            const [messages, setMessages] = useState([{ role: 'model', text: 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¹Ø§Ø°! âœ¨' }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const endRef = useRef(null);
            const suggestions = ["Ø¯Ø¹Ø§Ø¡ ğŸ¤²", "Ù†ØµÙŠØ­Ø© ğŸ", "Ù‚ØµØ© ğŸŒ™", "ØµØ¯Ù‚Ø© ğŸ’°"];

            const sendMsg = async (text = input) => {
                const msgText = typeof text === 'string' ? text : input;
                if(!msgText.trim() || loading) return;
                const userMsg = { role: 'user', text: msgText };
                setMessages(p => [...p, userMsg]); setInput(''); setLoading(true);
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: "Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ù‚ØµÙŠØ±.\n\n" + msgText }] }] })
                    });
                    const data = await res.json();
                    setMessages(p => [...p, { role: 'model', text: data.candidates?.[0]?.content?.parts?.[0]?.text || "Ø®Ø·Ø£" }]);
                } catch(e) { setMessages(p => [...p, { role: 'model', text: "Ø®Ø·Ø£ Ø§ØªØµØ§Ù„" }]); }
                setLoading(false);
            };
            useEffect(() => endRef.current?.scrollIntoView({behavior:'smooth'}), [messages]);

            return (
                <div className="h-full flex flex-col p-3 pb-24">
                    <div className="flex-1 overflow-y-auto space-y-3 mb-3 hide-scroll">
                        {messages.map((m,i) => (
                            <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                <div className={`max-w-[85%] p-2 rounded-xl text-xs leading-relaxed ${m.role==='user'?'bg-emerald-600 text-white rounded-tl-none':'bg-white dark:bg-slate-800 rounded-tr-none border dark:border-slate-700 shadow-sm markdown-body'}`} dangerouslySetInnerHTML={{__html: marked.parse(m.text)}}/>
                            </div>
                        ))}
                        {loading && <div className="text-xs text-slate-400 p-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...</div>}
                        <div ref={endRef} />
                    </div>
                    {!loading && <div className="flex gap-2 overflow-x-auto pb-2 mb-1 no-scrollbar">{suggestions.map((s, i) => (<button key={i} onClick={() => sendMsg(s)} className="whitespace-nowrap px-2 py-1 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300 text-[10px] font-bold rounded-full border border-emerald-100 dark:border-emerald-800">{s}</button>))}</div>}
                    <div className="flex gap-2 p-1.5 bg-white dark:bg-slate-800 rounded-full border dark:border-slate-700 shadow-lg">
                        <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&sendMsg()} placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." className="flex-1 bg-transparent px-3 py-1 outline-none text-xs dark:text-white" />
                        <button onClick={()=>sendMsg()} disabled={loading} className="w-8 h-8 bg-emerald-600 rounded-full text-white flex items-center justify-center shadow-md active:scale-95"><Icons.Send size={14}/></button>
                    </div>
                </div>
            );
        };

        const ZakatCalculator = () => {
            const [values, setValues] = useState({ cash: '', gold: '', goldPrice: '65', silver: '', silverPrice: '0.8' });
            const [totalZakat, setTotalZakat] = useState(0);
            const calculate = () => {
                const cash = parseFloat(values.cash) || 0;
                const gold = (parseFloat(values.gold) || 0) * (parseFloat(values.goldPrice) || 0);
                const silver = (parseFloat(values.silver) || 0) * (parseFloat(values.silverPrice) || 0);
                const total = cash + gold + silver;
                if (total >= (85 * (parseFloat(values.goldPrice) || 0))) setTotalZakat(total * 0.025); else setTotalZakat(0);
            };
            return (
                <div className="space-y-3">
                    <h3 className="font-bold text-sm dark:text-white">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø²ÙƒØ§Ø©</h3>
                    <div className="space-y-2">
                        <div><label className="text-[10px] font-bold block mb-0.5">Ø§Ù„Ù†Ù‚Ø¯</label><input type="number" value={values.cash} onChange={e=>setValues({...values, cash:e.target.value})} className="w-full p-2 text-xs rounded-lg bg-slate-100 dark:bg-slate-800 outline-none" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" /></div>
                        <div className="flex gap-2"><input type="number" value={values.gold} onChange={e=>setValues({...values, gold:e.target.value})} className="w-full p-2 text-xs rounded-lg bg-slate-100 dark:bg-slate-800 outline-none" placeholder="Ø°Ù‡Ø¨ (Ø¬Ø±Ø§Ù…)" /><input type="number" value={values.goldPrice} onChange={e=>setValues({...values, goldPrice:e.target.value})} className="w-full p-2 text-xs rounded-lg bg-slate-100 dark:bg-slate-800 outline-none" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¬Ø±Ø§Ù…" /></div>
                        <button onClick={calculate} className="w-full py-2 bg-amber-600 text-white rounded-lg text-xs font-bold shadow-sm">Ø§Ø­Ø³Ø¨</button>
                    </div>
                    {totalZakat > 0 && <div className="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-center"><p className="text-[10px] font-bold">Ø§Ù„Ø²ÙƒØ§Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©</p><p className="text-xl font-black text-emerald-700 dark:text-emerald-500">{totalZakat.toLocaleString()}</p></div>}
                </div>
            );
        };

        const AIQuiz = () => {
            const [q, setQ] = useState(null);
            const [loading, setLoading] = useState(false);
            const [score, setScore] = useState(0);
            const [answered, setAnswered] = useState(null);
            const fetchQuestion = async () => {
                setLoading(true); setAnswered(null); setQ(null);
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: "Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù† Ø±Ù…Ø¶Ø§Ù† JSON: { \"q\": \"Ø§Ù„Ø³Ø¤Ø§Ù„\", \"o\": [\"1\", \"2\", \"3\", \"4\"], \"a\": index }" }] }] })
                    });
                    const data = await res.json();
                    const text = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
                    setQ(JSON.parse(text));
                } catch(e) {}
                setLoading(false);
            };
            useEffect(() => { fetchQuestion(); }, []);
            return (
                <div className="space-y-3 text-center">
                    <div className="flex justify-between items-center"><h3 className="font-bold text-sm dark:text-white">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3><span className="px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-[10px] font-bold">Ù†Ù‚Ø§Ø·: {score}</span></div>
                    {loading ? <div className="py-5 text-xs text-slate-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div> : q && (
                        <div className="animate-fade-in">
                            <p className="text-sm font-bold mb-3">{q.q}</p>
                            <div className="grid gap-2">{q.o.map((opt, i) => (<button key={i} disabled={answered !== null} onClick={()=>{setAnswered(i); if(i===q.a) setScore(s=>s+10)}} className={`p-2 rounded-lg font-bold text-xs transition-all ${answered===null?'bg-slate-100 dark:bg-slate-800':i===q.a?'bg-emerald-500 text-white':answered===i?'bg-red-500 text-white':'opacity-50 bg-slate-100'}`}>{opt}</button>))}</div>
                            {answered !== null && <button onClick={fetchQuestion} className="mt-3 w-full py-2 bg-slate-900 text-white rounded-lg text-xs font-bold">Ø§Ù„ØªØ§Ù„ÙŠ</button>}
                        </div>
                    )}
                </div>
            );
        };

        const KhatamPlanner = () => {
            const [days, setDays] = useState(30);
            return (
                <div className="space-y-4">
                    <h3 className="font-bold text-sm dark:text-white">Ø§Ù„Ø®ØªÙ…Ø©</h3>
                    <div className="bg-slate-100 dark:bg-slate-800 p-3 rounded-xl">
                        <label className="block text-xs font-bold mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: {days}</label>
                        <input type="range" min="3" max="30" value={days} onChange={e=>setDays(e.target.value)} className="w-full accent-emerald-600" />
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                        <div className="p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg text-center border border-emerald-100 dark:border-emerald-800"><p className="text-xl font-black text-emerald-700 dark:text-emerald-400">{Math.ceil(604/days)}</p><p className="text-[10px] text-slate-500 font-bold">ØµÙØ­Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</p></div>
                        <div className="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center border border-blue-100 dark:border-blue-800"><p className="text-xl font-black text-blue-700 dark:text-blue-400">{Math.ceil(604/days/5)}</p><p className="text-[10px] text-slate-500 font-bold">Ø¨Ø¹Ø¯ ÙƒÙ„ ØµÙ„Ø§Ø©</p></div>
                    </div>
                </div>
            );
        };

        const IslamicHistory = () => {
            const [event, setEvent] = useState(null);
            useEffect(() => {
                fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Ø­Ø¯Ø« ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø±Ù…Ø¶Ø§Ù†. Ø§Ø®ØªØµØ§Ø± Ø´Ø¯ÙŠØ¯.` }] }] })
                }).then(r=>r.json()).then(d=>setEvent(d.candidates?.[0]?.content?.parts?.[0]?.text)).catch(()=>{});
            }, []);
            return (
                <div className="space-y-2">
                    <h3 className="font-bold text-sm dark:text-white">Ø­Ø¯Ø« ÙÙŠ Ø±Ù…Ø¶Ø§Ù†</h3>
                    <div className="bg-white dark:bg-slate-800 p-3 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 text-center text-xs leading-loose text-slate-600 dark:text-slate-300">
                        {event || "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."}
                    </div>
                </div>
            );
        };

        const ToolsHub = ({ userHabits, onSaveHabits }) => {
            const [view, setView] = useState('menu');
            const [habits, setHabits] = useState(userHabits || {});
            const [cardName, setCardName] = useState('');
            const canvasRef = useRef(null);

            const toolsList = [
                {id:'card', n:'Ø¨Ø·Ø§Ù‚Ø©', i:Icons.Image, c:'bg-purple-100 text-purple-600'},
                {id:'habits', n:'Ø¬Ø¯ÙˆÙ„', i:Icons.Check, c:'bg-emerald-100 text-emerald-600'},
                {id:'zakat', n:'Ø²ÙƒØ§Ø©', i:Icons.Calculator, c:'bg-amber-100 text-amber-600'},
                {id:'quiz', n:'Ù…Ø³Ø§Ø¨Ù‚Ø©', i:Icons.Brain, c:'bg-blue-100 text-blue-600'},
                {id:'khatam', n:'Ø®ØªÙ…Ø©', i:Icons.Book, c:'bg-teal-100 text-teal-600'},
                {id:'history', n:'Ø­Ø¯Ø«', i:Icons.History, c:'bg-rose-100 text-rose-600'},
                {id:'qibla', n:'Ø§Ù„Ù‚Ø¨Ù„Ø©', i:Icons.Compass, c:'bg-slate-100 text-slate-600', u:'https://qiblafinder.withgoogle.com'}
            ];

            useEffect(() => { if(userHabits) setHabits(userHabits); }, [userHabits]);

            const toggleHabit = (k) => {
                const today = new Date().toDateString();
                const newHabits = { ...habits, [today]: { ...habits[today], [k]: !(habits[today]?.[k]) } };
                setHabits(newHabits); onSaveHabits(newHabits);
            };

            const drawCard = () => {
                if(!canvasRef.current) return;
                const ctx = canvasRef.current.getContext('2d');
                const grd = ctx.createLinearGradient(0,0,0,600); grd.addColorStop(0,'#10b981'); grd.addColorStop(1,'#064e3b');
                ctx.fillStyle = grd; ctx.fillRect(0,0,600,600);
                ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.lineWidth = 15; ctx.strokeRect(20, 20, 560, 560);
                ctx.textAlign = 'center'; ctx.fillStyle = '#fbbf24'; ctx.font = 'bold 60px "Amiri", Arial'; ctx.fillText("Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…", 300, 200);
                ctx.fillStyle = '#fff'; ctx.font = 'bold 45px Arial'; ctx.fillText(cardName||"Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§", 300, 320);
                ctx.font = '25px Arial'; ctx.fillText("ÙŠÙ‡Ù†Ø¦ÙƒÙ… Ø¨Ø­Ù„ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ÙØ¶ÙŠÙ„", 300, 400);
                ctx.font = '16px Arial'; ctx.fillText("ØªØµÙ…ÙŠÙ…: Ù…Ø¹Ø§Ø° Ø§Ù„Ø®ÙˆØ§Ù„Ø¯Ø©", 300, 550);
            };
            useEffect(() => { if(view==='card') drawCard(); }, [view, cardName]);

            const ToolsNav = () => (
                <div className="flex gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar border-b border-slate-100 dark:border-slate-800">
                    <button onClick={()=>setView('menu')} className="p-1.5 bg-slate-100 dark:bg-slate-800 rounded-lg text-slate-500"><Icons.Grid size={16}/></button>
                    {toolsList.map(t => (
                        <button key={t.id} onClick={()=>t.u?window.open(t.u):setView(t.id)} className={`flex items-center gap-1 px-3 py-1 rounded-lg whitespace-nowrap text-[10px] font-bold transition-colors ${view===t.id ? 'bg-emerald-600 text-white shadow-md' : 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-100 dark:border-slate-700'}`}>
                            <t.i size={12}/> {t.n}
                        </button>
                    ))}
                </div>
            );

            if(view === 'menu') return (
                <div className="p-4 pb-28 grid grid-cols-3 gap-2 overflow-y-auto animate-fade-in">
                    {toolsList.map(t => (
                        <button key={t.id} onClick={()=>t.u?window.open(t.u):setView(t.id)} className={`p-2 rounded-xl flex flex-col items-center justify-center gap-2 h-20 ${t.c} dark:bg-slate-800 dark:text-slate-200 transition-transform active:scale-95 shadow-sm border border-transparent dark:border-slate-700`}>
                            <t.i size={20}/> <span className="font-bold text-[10px]">{t.n}</span>
                        </button>
                    ))}
                    <div className="col-span-3 text-center text-[9px] opacity-50 mt-2">Moath Al-Khawaldeh Edition</div>
                </div>
            );

            return (
                <div className="p-4 pb-28 h-full flex flex-col overflow-y-auto">
                    <ToolsNav />
                    {view === 'card' && <div className="space-y-3 animate-fade-in"><h3 className="font-bold text-sm dark:text-white">ØµØ§Ù†Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h3><input type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" value={cardName} onChange={e=>setCardName(e.target.value)} className="w-full p-2 text-xs rounded-lg bg-slate-100 dark:bg-slate-800 outline-none" /><canvas ref={canvasRef} width={600} height={600} className="w-full rounded-xl shadow-md" /><button onClick={()=>{const l=document.createElement('a'); l.download='card.png'; l.href=canvasRef.current.toDataURL(); l.click()}} className="w-full py-2 bg-emerald-600 text-white rounded-lg font-bold text-xs flex justify-center gap-2"><Icons.Download size={14}/> Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button></div>}
                    {view === 'habits' && <div className="space-y-2 animate-fade-in"><h3 className="font-bold text-sm dark:text-white">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h3>{[{k:'f',l:'ØµÙŠØ§Ù…',i:'ğŸŒ™'},{k:'p',l:'ØªØ±Ø§ÙˆÙŠØ­',i:'ğŸ•Œ'},{k:'q',l:'ÙˆØ±Ø¯ Ù‚Ø±Ø¢Ù†',i:'ğŸ“–'},{k:'c',l:'ØµØ¯Ù‚Ø©',i:'ğŸ’°'}].map(h=>(<div key={h.k} onClick={()=>toggleHabit(h.k)} className={`p-3 rounded-xl border flex justify-between items-center cursor-pointer transition-all ${habits[new Date().toDateString()]?.[h.k]?'bg-emerald-500 text-white':'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700'}`}><div className="flex items-center gap-2"><span className="text-lg">{h.i}</span><span className="font-bold text-xs">{h.l}</span></div>{habits[new Date().toDateString()]?.[h.k] && <Icons.Check size={16}/>}</div>))}</div>}
                    {view === 'zakat' && <div className="animate-fade-in"><ZakatCalculator /></div>}
                    {view === 'quiz' && <div className="animate-fade-in"><AIQuiz /></div>}
                    {view === 'khatam' && <div className="animate-fade-in"><KhatamPlanner /></div>}
                    {view === 'history' && <div className="animate-fade-in"><IslamicHistory /></div>}
                </div>
            );
        };

        const SettingsPanel = ({ user, currentNotice, updatePublicNotice }) => {
            const [isAdmin, setIsAdmin] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [loginData, setLoginData] = useState({id:'', pass:''});
            const [notice, setNotice] = useState(currentNotice || '');
            const handleLogin = (e) => { e.preventDefault(); if(loginData.id === "2150502071" && loginData.pass === "0772536229") { setIsAdmin(true); setShowLogin(false); } else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); };
            return (
                <div className="p-5 pb-28 space-y-4 overflow-y-auto h-full">
                    <h2 className="text-lg font-bold dark:text-white flex items-center gap-2"><Icons.Settings size={20}/> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹Ø§Ø°</h2>
                    <div className="glass p-3 rounded-xl space-y-2 border-r-4 border-emerald-500">
                        <div className="flex justify-between items-center">
                            <h3 className="font-bold text-emerald-800 dark:text-emerald-400 text-xs">Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ | About</h3>
                            <span className="text-[9px] bg-emerald-100 text-emerald-800 px-2 py-0.5 rounded-full">v2.0</span>
                        </div>
                        <p className="text-[10px] text-slate-600 dark:text-slate-300 leading-relaxed text-justify">ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø´Ø§Ù…Ù„ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠØ© ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§. ÙŠÙˆÙØ± Ø§Ù„Ù…ØµØ­ÙØŒ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØªØŒ Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ©ØŒ ÙˆÙ…Ø³Ø§Ø¹Ø¯ AI.</p>
                    </div>
                    <div className="glass p-3 rounded-xl flex justify-between items-center"><span className="text-xs font-bold dark:text-slate-200">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</span><div className={`flex items-center gap-1 text-[10px] font-bold ${user ? 'text-emerald-600' : 'text-amber-500'}`}><span className={`w-1.5 h-1.5 rounded-full ${user ? 'bg-emerald-500 animate-pulse' : 'bg-amber-500'}`}></span>{user && db ? `Ù…ØªØµÙ„` : 'Ø¶ÙŠÙ'}</div></div>
                    {isAdmin ? (<div className="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-xl border border-emerald-200 dark:border-emerald-800"><h3 className="font-bold text-emerald-800 dark:text-emerald-400 mb-2 text-sm">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><input type="text" value={notice} onChange={e=>setNotice(e.target.value)} className="w-full p-2 mb-2 text-xs rounded border dark:bg-slate-800 dark:border-slate-600" /><div className="flex gap-2"><button onClick={()=>updatePublicNotice(notice)} className="bg-emerald-600 text-white px-3 py-1.5 rounded text-xs flex-1">Ù†Ø´Ø±</button><button onClick={()=>setIsAdmin(false)} className="text-red-500 text-xs px-2">Ø®Ø±ÙˆØ¬</button></div></div>) : (<button onClick={()=>setShowLogin(true)} className="w-full p-3 glass rounded-xl font-bold text-xs text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</button>)}
                    {showLogin && <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4"><div className="bg-white dark:bg-slate-900 rounded-2xl p-5 w-full max-w-xs shadow-2xl"><h3 className="text-lg font-bold mb-3 dark:text-white text-center">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><form onSubmit={handleLogin} className="space-y-3"><input type="text" placeholder="Ø§Ù„Ù…Ø¹Ø±Ù" value={loginData.id} onChange={e=>setLoginData({...loginData, id:e.target.value})} className="w-full p-2 rounded-lg bg-slate-100 dark:bg-slate-800 border-none outline-none text-sm" /><input type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value={loginData.pass} onChange={e=>setLoginData({...loginData, pass:e.target.value})} className="w-full p-2 rounded-lg bg-slate-100 dark:bg-slate-800 border-none outline-none text-sm" /><button type="submit" className="w-full py-2 bg-emerald-600 text-white rounded-lg font-bold text-sm shadow-lg">Ø¯Ø®ÙˆÙ„</button></form><button onClick={()=>setShowLogin(false)} className="mt-3 text-xs text-slate-500 w-full text-center">Ø¥Ù„ØºØ§Ø¡</button></div></div>}
                    <div className="text-center text-[10px] text-slate-400 mt-4">By Moath Al-Khawaldeh</div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('home');
            const [darkMode, setDarkMode] = useState(false);
            const [userData, setUserData] = useState({ bookmark: 1, tasbihCount: 0, habits: {} });
            const [publicData, setPublicData] = useState({ notice: "Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… Ù…Ù† Ù…Ø¹Ø§Ø° Ø§Ù„Ø®ÙˆØ§Ù„Ø¯Ø© ğŸŒ™" });
            const [prayerData, setPrayerData] = useState({ times: null, date: '', next: {}, left: '', location: '', lat: null, lng: null });

            useEffect(() => {
                if (!auth) return;
                const initAuth = async () => { try { if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) await signInWithCustomToken(auth, __initial_auth_token); else await signInAnonymously(auth); } catch (e) {} };
                initAuth();
                return onAuthStateChanged(auth, setUser);
            }, []);

            useEffect(() => {
                if (!user || !db) return;
                try {
                    const unsubUser = onSnapshot(doc(db, 'artifacts', appId, 'users', user.uid, 'userData'), (snap) => { if (snap.exists()) setUserData(prev => ({ ...prev, ...snap.data() })); });
                    const unsubPublic = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'adminInfo'), (snap) => { if (snap.exists()) setPublicData(prev => ({ ...prev, ...snap.data() })); });
                    return () => { unsubUser(); unsubPublic(); };
                } catch(e) {}
            }, [user]);

            const updateCloud = async (key, value) => {
                setUserData(prev => ({ ...prev, [key]: value }));
                if (!user || !db) return;
                try { await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'userData'), { [key]: value }, { merge: true }); } catch (e) {}
            };

            useEffect(() => {
                if(localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) { setDarkMode(true); document.documentElement.classList.add('dark'); }
                const fetchPrayers = async (lat, lng, name) => {
                    try {
                        const now = Math.floor(Date.now()/1000);
                        const res = await fetch(`https://api.aladhan.com/v1/timings/${now}?latitude=${lat}&longitude=${lng}&method=2`);
                        const json = await res.json();
                        if(json.code === 200) { const h = json.data.date.hijri; setPrayerData(d => ({ ...d, times: json.data.timings, location: name||json.data.meta.timezone, date: `${h.day} ${h.month.ar} ${h.year}`, lat, lng })); }
                    } catch(e) {}
                };
                if(navigator.geolocation) { navigator.geolocation.getCurrentPosition(p => fetchPrayers(p.coords.latitude, p.coords.longitude, null), () => fetchPrayers(31.95, 35.91, 'Ø¹Ù…Ø§Ù† (Ø§ÙØªØ±Ø§Ø¶ÙŠ)')); } 
                else { fetchPrayers(31.95, 35.91, 'Ø¹Ù…Ø§Ù† (Ø§ÙØªØ±Ø§Ø¶ÙŠ)'); }
            }, []);

            useEffect(() => {
                if(!prayerData.times) return;
                const interval = setInterval(() => {
                    const now = new Date();
                    const PN = {Fajr:'Ø§Ù„ÙØ¬Ø±',Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',Asr:'Ø§Ù„Ø¹ØµØ±',Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
                    const sch = Object.keys(PN).map(k => { const [h,m] = prayerData.times[k].split(':'); const t = new Date(); t.setHours(h,m,0); return {key:k, name:PN[k], time:t}; });
                    let n = sch.find(s=>s.time>now);
                    if(!n) { const tmr = new Date(sch[0].time); tmr.setDate(tmr.getDate()+1); n = {...sch[0], time:tmr}; }
                    const diff = n.time - now;
                    setPrayerData(d => ({...d, next:n, left: `${Math.floor((diff/(1000*60*60))%24)}:${Math.floor((diff/(1000*60))%60).toString().padStart(2,'0')}:${Math.floor((diff/1000)%60).toString().padStart(2,'0')}`}));
                }, 1000);
                return () => clearInterval(interval);
            }, [prayerData.times]);

            const toggleTheme = () => { setDarkMode(!darkMode); document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', !darkMode ? 'dark' : 'light'); };

            return (
                <div className={`h-full flex flex-col bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-500 overflow-hidden`}>
                    {publicData.notice && <div className="bg-gradient-to-r from-emerald-700 to-teal-600 text-white text-center py-1.5 text-[10px] font-bold shadow-md z-50 sticky top-0">{publicData.notice}</div>}
                    {activeTab !== 'quran' && (
                        <div className="px-4 py-3 flex justify-between items-center z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md sticky top-0">
                            <div>
                                <h1 className="text-base font-black text-emerald-800 dark:text-emerald-500 font-kufi leading-tight">Ø±Ù…Ø¶Ø§Ù†ÙŠØ§Øª Ù…Ø¹Ø§Ø° <span className="block text-[9px] font-sans text-emerald-600 dark:text-emerald-400">Moath Ramadaniyat</span></h1>
                            </div>
                            <button onClick={toggleTheme} className="p-1.5 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-gold-400 hover:scale-110 transition-transform">{darkMode ? <Icons.Sun size={16}/> : <Icons.Moon size={16} fill="currentColor"/>}</button>
                        </div>
                    )}
                    <div className="flex-1 overflow-hidden relative w-full">
                        {activeTab === 'home' && <Dashboard prayerData={prayerData} />}
                        {activeTab === 'quran' && <QuranReader savedPage={userData.bookmark} onSavePage={(p) => updateCloud('bookmark', p)} />}
                        {activeTab === 'imsakiya' && <Imsakiya locationData={prayerData} />}
                        {activeTab === 'adhkar' && <AdhkarHub savedCount={userData.tasbihCount} onSaveCount={(c) => updateCloud('tasbihCount', c)} />}
                        {activeTab === 'ai' && <GeminiAssistant />}
                        {activeTab === 'tools' && <ToolsHub userHabits={userData.habits} onSaveHabits={(h) => updateCloud('habits', h)} />}
                        {activeTab === 'settings' && <SettingsPanel user={user} currentNotice={publicData.notice} updatePublicNotice={async (txt) => { if(user && db) await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'adminInfo'), { notice: txt }, { merge: true }); }} />}
                    </div>
                    <RadioPlayer />
                    <div className="bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-t border-slate-200 dark:border-slate-800 pb-safe z-40 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
                        <div className="flex justify-around items-end h-[55px] pb-1">
                            <NavBtn icon={Icons.Home} label="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" active={activeTab==='home'} onClick={()=>setActiveTab('home')} />
                            <NavBtn icon={Icons.Table} label="Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ©" active={activeTab==='imsakiya'} onClick={()=>setActiveTab('imsakiya')} />
                            <div className="relative -top-3"><button onClick={()=>setActiveTab('quran')} className="w-10 h-10 rounded-full bg-gradient-to-tr from-emerald-500 to-teal-600 text-white shadow-xl flex items-center justify-center border-[3px] border-slate-50 dark:border-slate-950 active:scale-95 transition-transform"><Icons.Book size={20} /></button></div>
                            <NavBtn icon={Icons.Grid} label="Ø§Ù„Ø£Ø¯ÙˆØ§Øª" active={activeTab==='tools'} onClick={()=>setActiveTab('tools')} />
                            <NavBtn icon={Icons.Settings} label="Ù…Ø¹Ø§Ø°" active={activeTab==='settings'} onClick={()=>setActiveTab('settings')} />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>